<section id="account_section">
  <%= render :partial => "shared/sidebar" %>
  <div id="support" class="main_side">
    <div id="top_header">
      <h2 class="mb-0">Support</h2>
      <div class="header_side">
        <button type="button" class="noti_btn input">
          <img src="/assets/icon-bell.svg" alt="">
          <span>7</span>
        </button>
      </div>
    </div>
    <div class="ctn">
      <div class="row">
        <div class="col-4">
          <div class="users_blk">
            <div class="top_blk">
              <div class="form_blk input search_blk">
                <button type="button" class="btn">
                  <img src="/assets/search_icon.svg" alt="">
                </button>
                <input type="text" name="" class="input" placeholder="Search Messages">
              </div>
            </div>
            <ul class="users_list">
              <%@supports.each do |record|%>
                <li>
                  <div class="user">
                    <div class="img">
                      <% if record.user.image.attached?%>
                        <%= image_tag(record.user.image)%>
                      <% else %>
                        <img src="../../assets/images/default-profile.jpg" alt="">
                      <%end%>
                    </div>
                    <div class="txt">
                      <h6 class="mb-0"><%=record.user.name%></h6>
                      <div class="d-flex">
                        <p class="msg"><%=last_message(record.user)%></p>
                        <p>â€¢ <%=time_ago_in_words(last_seen(record.user)) if last_seen(record.user).present?  %></p>
                      </div>
                      <div class="u_msg">
                        <%=unread_count(record.user)%>
                      </div>
                    </div>
                  </div>
                </li>
              <%end%>
            </ul>
          </div>
        </div>
        <div class="col-8">
          <div class="chat_blk">
            <div class="top_blk">
              <div class="selected_chat">
                <div class="img">
                  <% if @last_support.user.image.attached?%>
                    <%= image_tag(@last_support.user.image)%>
                  <% else %>
                    <img src="../../assets/images/default-profile.jpg" alt="">
                  <%end%>
                </div>
                <div class="txt">
                  <h6 class="mb-0"><%=@last_support.user.name%></h6>
                  <p class="mb-0"><%=@last_support.ticket_number%></p>
                </div>
                <div class="dropdown">
                  <button class="site_btn blank sm dropdown-toggle chevron" data-bs-toggle="dropdown">
                    Mark as
                  </button>
                  <ul class="dropdown-menu" >
                    <li><button type="button">Ongoing</button></li>
                    <li><button type="button">Completed</button></li>
                  </ul>
                </div>
              </div>
            </div>
            <% @last_support.support_conversation.support_messages.each do |message|%>
              <div class="msg_contain">
                <div class="msg user">
                  <div class="profile">
                    <% if message.user.image.attached?%>
                      <%= image_tag(message.user.image)%>
                    <% else %>
                      <img src="../../assets/images/default-profile.jpg" alt="">
                    <%end%>
                  </div>
                  <div class="msg_wrapper">
                    <div class="msg_blk">
                      <p>Open a Support Ticket <strong><%=@last_support.ticket_number%></strong></p>
                      <p><%=message.body%></p>
                      <% if message.image.attached?%>
                      <div class="attch_blk">
                        <div class="img">
                          <%= image_tag message.image.url %>
                        </div>
                        <button type="button" class="btn down_btn">
                          <img src="/assets/icon-download.svg" alt="">
                        </button>
                      </div>
                      <%end%>
                    </div>
                    <p><%=message.created_at.to_formatted_s(:long)%></p>
                  </div>
                </div>
                <div class="msg admin">
                  <div class="profile">
                    <img src="/assets/support-user.png" alt="">
                  </div>
                  <div class="msg_wrapper">
                    <div class="msg_blk">
                      <p>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam pretium sem
                        sit amet venenatis commodo. Nullam aliquam lacus nisl, varius luctus 
                        mauris hendrerit ut. Etiam eros lectus, commodo nec nisl in, aliquet 
                        congue quam. Morbi condimentum lectus id urna gravida, at facilisis 
                        lectus consectetur. Lorem ipsum dolor sit amet, consectetur adipiscing 
                        elit.
                      </p>
                    </div>
                    <p>May 22, 2022 | 9:00am</p>
                  </div>
                </div>
              </div>
            <%end%>
            <%= form_with url: admin_send_message_admins_supports_path do |f| %>
              <%= hidden_field_tag :id, @last_support&.support_conversation.id %>
              <div class="send_blk">
                <div class="btn_blk flex-nowrap">
                  <button type="button" class="btn att-btn">
                    <%= image_tag "/assets/icon-attach.svg", alt: "attachFile", id: "clickaddfile" %>
                    <%= f.file_field :file, accept: 'application/pdf,application/vnd.ms-excel', id: "submitaddfile", style: "opacity:0" %>
                  </button>

                  <button type="button" class="btn att-btn">
                    <%= image_tag "/assets/icon-img", alt: "attachImage", id: "clickaddphoto" %>
                    <%= f.file_field :image, accept: 'image/png, image/gif, image/jpeg', id: "submitaddphoto", style: "opacity:0" %>
                  </button>
                </div>

                <input type="text" name="message" class="input" placeholder="Type your message here">
                <button type="submit" class="btn send_btn">
                  <img src="/assets/icon-send.svg" alt="">
                </button>
              </div>
            <%end%>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- account_section -->

<!-- Main Js -->
<script src="/assets/main.js"></script>